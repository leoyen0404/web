<!doctype html>
<html lang="zh-Hant">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>顯示並下載 C++ 程式碼</title>
		<style>
			:root {
				--bg: #0d1117;
				--panel: #161b22;
				--border: #30363d;
				--text: #c9d1d9;
				--muted: #8b949e;
				--accent: #2f81f7;
				--accent-press: #1f6feb;
				--success: #2ea043;
				--radius: 12px;
				--mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
			}

			html, body {
				height: 100%;
				margin: 0;
				background: var(--bg);
				color: var(--text);
				font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
			}

			.page {
				max-width: 960px;
				margin: 24px auto;
				padding: 0 16px 48px;
			}

			.header {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 12px;
				margin-bottom: 12px;
			}

			.title {
				font-size: 18px;
				color: var(--muted);
				margin: 0;
			}

			.toolbar {
				display: flex;
				gap: 8px;
			}

			button {
				appearance: none;
				border: 1px solid var(--border);
				background: var(--panel);
				color: var(--text);
				padding: 8px 12px;
				border-radius: 8px;
				font: inherit;
				cursor: pointer;
				transition: background .15s ease, border-color .15s ease, transform .02s ease;
			}
			button:hover { border-color: var(--accent); }
			button:active { transform: translateY(1px); }
			.primary { background: var(--accent); border-color: var(--accent); }
			.primary:hover { background: var(--accent-press); border-color: var(--accent-press); }

			.code-card {
				border: 1px solid var(--border);
				border-radius: var(--radius);
				overflow: hidden;
				background: var(--panel);
				box-shadow: 0 0 0 1px rgba(0,0,0,0.05), 0 8px 24px rgba(0,0,0,0.2);
			}

			pre {
				margin: 0;
				padding: 16px;
				overflow: auto;
				background: transparent;
			}
					code {
						font-family: var(--mono);
						font-size: 14px;
						line-height: 1.55;
						color: var(--text);
						white-space: pre-wrap; /* 保留換行並允許自動換行 */
						tab-size: 4;
					}

			.footer-hint {
				color: var(--muted);
				font-size: 13px;
				margin-top: 12px;
			}
		</style>
	</head>
	<body>
		<div class="page">
			<div class="header">
				<h1 class="title">pwmled.cpp</h1>
				<div class="toolbar">
					<button id="copyBtn" title="Copy to clipboard">Copy</button>
					<button id="downloadBtn" class="primary" title="Download as pwmled.cpp">Download pwmled.cpp</button>
				</div>
			</div>

			<div class="code-card">
				<pre><code id="code-block" class="language-cpp"></code></pre>
			</div>

			<p class="footer-hint">提示：點擊 Copy 可複製整段程式碼；Download 會下載名為 <strong>pwmled.cpp</strong> 的檔案。</p>
		</div>

		<!-- 將原始 C++ 程式碼放在 text/plain 的腳本中，避免 HTML 轉譯問題 -->
		<script id="code-src" type="text/plain">//
	// PWM LED
	//
	#include &lt;iostream&gt;
	#include &lt;wiringPi.h&gt;
	#include &lt;softPwm.h&gt;

	using namespace std;

	const int led = 1;

	int main(void) {
		if (wiringPiSetup() == -1) {
			return 0;
		}

		softPwmCreate(led, 0, 100);

		while (1) {
			for (int val = 0; val &lt;= 100; val++) {
				softPwmWrite(led, val);
				delay(20);
			}

			for (int val = 100; val &gt;= 0; val--) {
				softPwmWrite(led, val);
				delay(20);
			}
		}

		return 1;
	}
	</script>

		<script>
					(function () {
						const codeEl = document.getElementById('code-block');
						const srcEl = document.getElementById('code-src');
						const copyBtn = document.getElementById('copyBtn');
						const downloadBtn = document.getElementById('downloadBtn');

						let code = '';

						function setCode(text) {
							code = (text || '').replace(/\n$/, '');
							codeEl.innerText = code; // 保留換行
						}

						function setBusy(btn, label, ms = 1200) {
					const prev = btn.textContent;
					btn.textContent = label;
					btn.disabled = true;
					setTimeout(() => { btn.textContent = prev; btn.disabled = false; }, ms);
				}

				async function copyToClipboard(text) {
					try {
						if (navigator.clipboard && window.isSecureContext) {
							await navigator.clipboard.writeText(text);
							return true;
						}
						// 非安全脈絡或權限不足時的降級方案
						const textarea = document.createElement('textarea');
						textarea.value = text;
						textarea.style.position = 'fixed';
						textarea.style.top = '-1000px';
						document.body.appendChild(textarea);
						textarea.focus();
						textarea.select();
						const ok = document.execCommand('copy');
						document.body.removeChild(textarea);
						return ok;
					} catch (err) {
						return false;
					}
				}

						copyBtn.addEventListener('click', async () => {
					const ok = await copyToClipboard(code);
					setBusy(copyBtn, ok ? 'Copied!' : 'Copy failed');
				});

				downloadBtn.addEventListener('click', () => {
					const blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = 'pwmled.cpp';
					document.body.appendChild(a);
					a.click();
					a.remove();
					setTimeout(() => URL.revokeObjectURL(url), 1000);
					setBusy(downloadBtn, 'Downloading...');
				});

						// 嘗試從同目錄動態載入最新的 temp.cpp；若失敗則回退到內嵌版本
						(async () => {
							try {
								const url = 'pwmled.cpp?t=' + Date.now(); // cache-busting 確保拿到最新
								const res = await fetch(url, { cache: 'no-store' });
								if (!res.ok) throw new Error('HTTP ' + res.status);
								const text = await res.text();
								setCode(text);
							} catch (e) {
								// 多數情況是在 file:// 開啟，瀏覽器會阻擋 fetch，此時使用內嵌備援
								setCode(srcEl.textContent);
							}
						})();
			})();
		</script>
	</body>
</html>
