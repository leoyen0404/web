<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glassmorphism Phone UI Demo - White Widgets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Custom styles for the demo */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow: hidden; /* Prevent scrollbars during animation */
            background: linear-gradient(to bottom right, #f0f4f8, #d9e2ec);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Phone Frame Styles - Uses mask */
        .phone-frame {
            width: 320px;
            height: 640px;
            background-color: #111827;
            /* border-radius removed */
            padding: 10px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35), inset 0 0 0 3px rgba(255,255,255,0.05);
            position: relative;
            overflow: hidden; /* Keep for mask */
            /* Mask properties applied by JS */
        }

        /* Phone Screen Styles - Uses mask */
        .phone-screen {
            width: 100%;
            height: 100%;
            background-color: #ffffffe9; /* Fallback */
            /* border-radius removed */
            position: relative; /* Needed for absolute positioning of children */
            overflow: hidden; /* Clip background elements */
            display: flex;
            flex-direction: column;
            padding: 20px 15px;
            /* Mask properties applied by JS */
            --phone-screen-radius: 60px;
        }

        /* Container for the MOVING wallpaper blocks */
        .background-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            /* Mask on parent handles clipping */
        }

        /* MOVING Wallpaper Block Styles */
        .color-block {
            position: absolute;
            opacity: 0.85;
            animation: move 25s infinite linear alternate;
            will-change: transform, border-radius;
        }

        /* Define wallpaper blocks */
         .block-1 { background-color: #0077b6; width: 180px; height: 250px; top: -30px; left: -50px; border-radius: 30% 70% 50% 50% / 30% 30% 70% 70%; transform: rotate(-15deg); animation-duration: 28s; --initial-rotate: -15deg; --initial-radius: 30% 70% 50% 50% / 30% 30% 70% 70%; }
        .block-2 { background-color: #ffb703; width: 220px; height: 180px; top: 150px; left: 80px; border-radius: 70% 30% 80% 20% / 60% 70% 30% 40%; transform: rotate(25deg); opacity: 0.8; animation-duration: 24s; animation-delay: -7s; --initial-rotate: 25deg; --initial-radius: 70% 30% 80% 20% / 60% 70% 30% 40%; }
        .block-3 { background-color: #e63946; width: 150px; height: 200px; bottom: -40px; left: 20px; border-radius: 50% 50% 30% 70% / 60% 40% 60% 40%; transform: rotate(10deg); animation-duration: 30s; animation-delay: -12s; --initial-rotate: 10deg; --initial-radius: 50% 50% 30% 70% / 60% 40% 60% 40%; }
        .block-4 { background-color: #2ec4b6; width: 190px; height: 160px; top: 350px; right: -60px; border-radius: 40% 60% 70% 30% / 50% 60% 40% 50%; transform: rotate(-30deg); opacity: 0.75; animation-duration: 26s; animation-delay: -18s; --initial-rotate: -30deg; --initial-radius: 40% 60% 70% 30% / 50% 60% 40% 50%; }
         .block-5 { background-color: #fb8500; width: 120px; height: 100px; top: 80px; left: 30px; border-radius: 50%; opacity: 0.9; animation-duration: 22s; animation-delay: -4s; --initial-rotate: 0deg; --initial-radius: 50%; }

        /* Keyframes for gentle drifting and morphing */
        @keyframes move {
            0% { transform: translate(0, 0) scale(1) rotate(var(--initial-rotate, 0deg)); border-radius: var(--initial-radius, 50%); }
            50% { transform: translate(15px, 25px) scale(1.05) rotate(calc(var(--initial-rotate, 0deg) + 30deg)); border-radius: 40% 60% 60% 40% / 70% 50% 50% 30%; }
            100% { transform: translate(-10px, -20px) scale(0.95) rotate(calc(var(--initial-rotate, 0deg) - 20deg)); border-radius: var(--initial-radius, 50%); }
        }

         /* Glassmorphism Element Style (Widgets) - Uses mask */
        .glass-element {
            /* --- MODIFIED: White Glassmorphism --- */
            background: rgba(255, 255, 255, 0.5); /* Increased opacity */
            color: #374151; /* Dark text color for contrast */
            /* --- END MODIFIED --- */
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3); /* Keep border subtle */
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            position: relative;
            z-index: 1;
            margin-bottom: 15px;
            flex-shrink: 0;
            overflow: hidden; /* Needed for mask to clip content */
            /* Mask properties applied by JS */
            --widget-radius: 28px; /* Define CSS variable for radius */
        }
        .glass-element:last-child {
            margin-bottom: 0; /* Remove bottom margin from the very last element in the container */
        }

        /* Search Bar Widget */
        .search-widget {
            padding: 10px 15px; /* Adjust padding */
            display: flex;
            align-items: center;
             /* Inherits dark color from .glass-element */
        }
        .search-widget i { /* Style for the icon */
            font-size: 16px;
            margin-right: 10px; /* Space between icon and input */
            opacity: 0.6; /* Adjusted opacity for dark icon */
            color: #4b5563; /* Slightly lighter dark grey */
        }
        .search-widget input[type="search"] {
            flex-grow: 1; /* Take remaining space */
            background: transparent; /* Transparent background */
            border: none; /* No border */
            outline: none; /* No focus outline */
            color: #1f2937; /* Darker color for input text */
            font-size: 14px;
            font-weight: 500;
            width: 100%; /* Ensure it tries to fill */
        }
        .search-widget input[type="search"]::placeholder { /* Placeholder style */
            color: #6b7280; /* Darker placeholder */
            opacity: 1; /* Override default opacity */
        }
        /* Remove default search input cancel button (optional) */
        .search-widget input[type="search"]::-webkit-search-cancel-button,
        .search-widget input[type="search"]::-webkit-search-decoration {
             -webkit-appearance: none;
             appearance: none;
        }

        /* Spacer div */
        .spacer {
            flex-grow: 1; /* Pushes elements below it downwards */
        }

        /* App Icon Grid */
        .app-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px; /* Keep gap */
            position: relative;
            z-index: 1; /* Above background */
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        /* Individual App Icon Style - Uses mask */
        .app-icon {
            aspect-ratio: 1 / 1;
            background-color: rgba(245, 245, 245, 0.9); /* Keep icon background light */
            /* border-radius: 18px; */ /* Replaced by mask */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #374151; /* Default icon color (already darkish) */
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s ease-in-out;
            overflow: hidden; /* Needed for mask */
            cursor: pointer; /* Indicate clickable */
            position: relative; /* Needed for z-index */
            z-index: 2; /* Ensure icons are clickable above widgets */
            /* Mask properties applied by JS */
            --icon-radius: 18px; /* Define CSS variable for radius */
        }
        .app-icon:hover {
            transform: scale(1.05);
        }
        /* Explicit background/text colors using Tailwind classes in HTML for app icons */

        /* Music Widget Style */
        .music-widget {
            padding: 15px;
            display: flex;
            align-items: center;
            /* Inherits dark color from .glass-element */
            /* text-shadow removed */
        }
        .music-widget img {
            width: 50px;
            height: 50px;
            border-radius: 18px; /* Keep simple radius for inner image */
            margin-right: 12px;
            object-fit: cover;
            background-color: rgba(0,0,0,0.05); /* Darker placeholder bg */
            flex-shrink: 0;
        }
        .music-info { flex-grow: 1; margin-right: 12px; overflow: hidden; }
        .music-info .title { font-weight: 600; font-size: 14px; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #1f2937; } /* Darker text */
        .music-info .artist { font-weight: 400; font-size: 12px; opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #4b5563; } /* Darker text */
        .music-controls { flex-shrink: 0; }
        .music-controls button { background: none; border: none; color: #4b5563; /* Darker buttons */ font-size: 18px; padding: 5px; cursor: pointer; opacity: 0.8; transition: opacity 0.2s ease; }
        .music-controls button:hover { opacity: 1; }
        .music-controls .play-pause { font-size: 18px; margin: 0 5px; }

        /* Weather Widget Style (Bottom) */
        .weather-widget {
            height: auto;
            padding: 18px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            /* Inherits dark color from .glass-element */
            /* text-shadow removed */
        }
        .widget-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;}
        .widget-location { font-size: 16px; font-weight: 600; color: #1f2937;} /* Darker text */
        .widget-temp { font-size: 44px; font-weight: 700; line-height: 1; color: #111827;} /* Darkest text */
        .widget-condition { font-size: 14px; font-weight: 500; text-align: right; color: #4b5563;} /* Darker text */
        .widget-icon { font-size: 26px; margin-bottom: 4px; color: #4b5563;} /* Darker icon */

        /* --- App Open Animation Styles --- */
        #app-open-overlay {
            position: fixed; /* Use fixed positioning relative to viewport */
            top: 0; /* Positioned via transform */
            left: 0; /* Positioned via transform */
            width: 0; /* Initial size set by JS */
            height: 0; /* Initial size set by JS */
            background-color: #ccc; /* Placeholder, will be set by JS */
            z-index: 1000; /* High z-index above everything */
            opacity: 0; /* Start transparent */
            transform-origin: top left; /* Consistent origin for transforms */
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        mask-image 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        -webkit-mask-image 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 0; /* Keep at 0 */
            overflow: hidden; /* Needed for mask */
            display: none; /* Initially hidden */
            cursor: pointer; /* Indicate it's clickable to close */
            will-change: width, height, transform, opacity, mask-image, -webkit-mask-image; /* Optimize animation */
            /* Mask properties applied by JS */
        }

        #app-open-overlay.visible {
           display: block; /* Make it visible for animation */
           opacity: 1; /* Become opaque */
        }

    </style>
</head>
<body>

    <div class="phone-frame">
        <div class="phone-screen">
            <div class="background-container">
                <div class="color-block block-1"></div>
                <div class="color-block block-2"></div>
                <div class="color-block block-3"></div>
                <div class="color-block block-4"></div>
                <div class="color-block block-5"></div>
            </div>

            <div class="spacer"></div>

            <div class="search-widget glass-element">
                <i class="fab fa-google"></i> <input type="search" placeholder="Search Google or type a URL">
            </div>
            <div class="app-grid">
                 <div class="app-icon bg-green-500 text-white"><i class="fas fa-phone"></i></div>
                <div class="app-icon bg-blue-500 text-white"><i class="fas fa-comment-dots"></i></div>
                 <div class="app-icon bg-teal-500 text-white"><i class="fab fa-safari"></i></div>
                <div class="app-icon bg-red-500 text-white"><i class="fas fa-envelope"></i></div>
                 <div class="app-icon bg-yellow-500 text-white"><i class="fas fa-camera"></i></div>
                <div class="app-icon bg-purple-500 text-white"><i class="fas fa-music"></i></div>
                <div class="app-icon bg-orange-500 text-white"><i class="fas fa-map-marker-alt"></i></div>
                 <div class="app-icon bg-cyan-500 text-white"><i class="fas fa-calendar-alt"></i></div>
                 <div class="app-icon bg-pink-500 text-white"><i class="fas fa-heart"></i></div>
                 <div class="app-icon bg-lime-500 text-white"><i class="fas fa-play"></i></div>
                 <div class="app-icon bg-gray-200 text-gray-700"><i class="fas fa-cloud"></i></div>
                 <div class="app-icon bg-indigo-500 text-white"><i class="fas fa-cog"></i></div>
            </div>

            <div class="music-widget glass-element">
                 <img src="https://placehold.co/100x100/cccccc/333333?text=Album" alt="Album Art" onerror="this.src='https://placehold.co/100x100/cccccc/ffffff?text=Error'"> <div class="music-info">
                     <div class="title">Sunset Drive</div>
                     <div class="artist">Lofi Chillhop</div>
                 </div>
                 <div class="music-controls">
                     <button aria-label="Previous Track"><i class="fas fa-backward-step"></i></button>
                     <button aria-label="Play/Pause" class="play-pause"><i class="fas fa-play"></i></button>
                     <button aria-label="Next Track"><i class="fas fa-forward-step"></i></button>
                 </div>
            </div>

            <div class="weather-widget glass-element">
                 <div class="widget-header">
                     <div>
                         <div class="widget-location">Taichung City</div>
                          <div class="widget-temp">28&deg;</div>
                     </div>
                     <div class="text-right">
                         <div class="widget-icon"><i class="fas fa-cloud-sun"></i></div>
                         <div class="widget-condition">Partly Cloudy</div>
                     </div>
                 </div>
            </div>

        </div>
    </div>
    <div id="app-open-overlay"></div>


    <script>
        // --- Constants for Radii ---
        const ICON_RADIUS = '18px';
        const PHONE_SCREEN_RADIUS = '60px';
        const WIDGET_RADIUS = '40px';

        /**
         * Generates an SVG path string for continuous curvature corners.
         */
        function generateContinuousPath(W, H, r) {
            let radius = parseFloat(r);
            radius = Math.min(radius, W / 2, H / 2);
            if (radius < 0) radius = 0;
            const k = 0.5522847498;
            const ox = radius * k;
            const oy = radius * k;
            const pathData = `M 0 ${radius} C 0 ${radius - oy}, ${radius - ox} 0, ${radius} 0 L ${W - radius} 0 C ${W - radius + ox} 0, ${W} ${radius - oy}, ${W} ${radius} L ${W} ${H - radius} C ${W} ${H - radius + oy}, ${W - radius + ox} ${H}, ${W - radius} ${H} L ${radius} ${H} C ${radius - ox} ${H}, 0 ${H - radius + oy}, 0 ${H - radius} Z`.replace(/\s+/g, ' ').trim();
            return pathData;
        }

        /**
         * Applies an SVG mask for continuous curvature corners.
         */
        function applySquircleMask(element, radius, width, height) {
            if (!element) return;
            const rect = element.getBoundingClientRect();
            const W = width > 0 ? width : (element.offsetWidth > 0 ? element.offsetWidth : rect.width);
            const H = height > 0 ? height : (element.offsetHeight > 0 ? element.offsetHeight : rect.height);
            if (W <= 0 || H <= 0) {
                if(element.id !== 'app-open-overlay') { console.warn('Skipping mask application for element with zero/invalid dimensions:', element, W, H); }
                return;
            }
            const path = generateContinuousPath(W, H, radius);
            const svgMask = `<svg xmlns='http://www.w3.org/2000/svg' width='${W}' height='${H}' viewBox='0 0 ${W} ${H}'><path d='${path}' fill='black'/></svg>`;
            const dataUrl = `url("data:image/svg+xml;utf8,${encodeURIComponent(svgMask)}")`;
            element.style.webkitMaskImage = dataUrl;
            element.style.maskImage = dataUrl;
            element.style.webkitMaskSize = '100% 100%';
            element.style.maskSize = '100% 100%';
            element.style.webkitMaskRepeat = 'no-repeat';
            element.style.maskRepeat = 'no-repeat';
            element.style.webkitMaskComposite = 'source-in';
            element.style.maskComposite = 'intersect';
            element.style.borderRadius = '0';
        }

        /**
         * Removes the SVG mask from an element.
         */
        function removeSquircleMask(element) {
            if (!element) return;
            element.style.webkitMaskImage = 'none';
            element.style.maskImage = 'none';
        }


        // --- Apply Masks on Load ---
        document.addEventListener('DOMContentLoaded', () => {
            const phoneFrame = document.querySelector('.phone-frame');
            const phoneScreen = document.querySelector('.phone-screen');
            const appIcons = document.querySelectorAll('.app-icon');
            const widgets = document.querySelectorAll('.glass-element');

             const phoneFrameRadius = '70px';
             const phoneScreenRadius = PHONE_SCREEN_RADIUS;
             const iconRadius = ICON_RADIUS;
             const widgetRadius = WIDGET_RADIUS;

            if (phoneFrame) applySquircleMask(phoneFrame, phoneFrameRadius);
            if (phoneScreen) applySquircleMask(phoneScreen, phoneScreenRadius);
            appIcons.forEach(icon => applySquircleMask(icon, iconRadius));
            widgets.forEach(widget => applySquircleMask(widget, widgetRadius));

            if (phoneScreen) {
                setupAppOpenAnimation(phoneScreen);
            } else {
                console.error("Phone screen element not found!");
            }
        });

         // --- Optional: Re-apply masks on resize ---
         let resizeTimeout;
         window.addEventListener('resize', () => {
             clearTimeout(resizeTimeout);
             resizeTimeout = setTimeout(() => {
                 console.log("Re-applying masks on resize");
                 const phoneFrame = document.querySelector('.phone-frame');
                 const phoneScreen = document.querySelector('.phone-screen');
                 const appIcons = document.querySelectorAll('.app-icon');
                 const widgets = document.querySelectorAll('.glass-element');
                 const overlay = document.getElementById('app-open-overlay');

                 const phoneFrameRadius = '70px';
                 const phoneScreenRadius = PHONE_SCREEN_RADIUS;
                 const iconRadius = ICON_RADIUS;
                 const widgetRadius = WIDGET_RADIUS;

                 if (phoneFrame) applySquircleMask(phoneFrame, phoneFrameRadius);
                 if (phoneScreen) applySquircleMask(phoneScreen, phoneScreenRadius);
                 appIcons.forEach(icon => applySquircleMask(icon, iconRadius));
                 widgets.forEach(widget => applySquircleMask(widget, widgetRadius));

                 if (overlay && overlay.style.display === 'block' && overlay.classList.contains('visible')) {
                    const phoneScreenRect = phoneScreen?.getBoundingClientRect();
                    const screenWidth = phoneScreen?.offsetWidth;
                    const screenHeight = phoneScreen?.offsetHeight;
                    if (phoneScreenRect && screenWidth && screenHeight) {
                         overlay.style.width = `${screenWidth}px`;
                         overlay.style.height = `${screenHeight}px`;
                         overlay.style.transform = `translate(${phoneScreenRect.left}px, ${phoneScreenRect.top}px)`;
                         applySquircleMask(overlay, phoneScreenRadius, screenWidth, screenHeight);
                    }
                 }
             }, 150);
         });

         // --- App Open Animation Logic ---
        /**
         * Sets up the click listeners and animation logic for app icons.
         */
        function setupAppOpenAnimation(phoneScreenElement) {
            const icons = document.querySelectorAll('.app-icon');
            const overlay = document.getElementById('app-open-overlay');
            if (!overlay) { console.error("Overlay element not found!"); return; }
            let currentIcon = null, isAnimating = false, animationDirection = null, lastIconRect = null;

            const openTransitionEndHandler = (event) => {
                if (['transform', 'width', 'height'].includes(event.propertyName)) {
                    isAnimating = false; animationDirection = null;
                    overlay.removeEventListener('transitionend', openTransitionEndHandler);
                    console.log("Open transition finished for:", event.propertyName);
                }
            };
            const closeTransitionEndHandler = (event) => {
                 if (['transform', 'width', 'height'].includes(event.propertyName)) {
                    isAnimating = false; animationDirection = null;
                    overlay.style.display = 'none'; overlay.classList.remove('visible');
                    removeSquircleMask(overlay); currentIcon = null; lastIconRect = null;
                    overlay.removeEventListener('transitionend', closeTransitionEndHandler);
                    overlay.removeEventListener('click', closeOverlay);
                    console.log("Close transition finished for:", event.propertyName);
                 }
            };
            function closeOverlay() {
                if (!currentIcon || !lastIconRect) { console.log("Close cancelled: Missing icon or screen data"); return; }
                if (isAnimating && animationDirection === 'closing') return;
                console.log("Closing animation triggered");
                isAnimating = true; animationDirection = 'closing';
                overlay.removeEventListener('transitionend', openTransitionEndHandler);
                overlay.removeEventListener('transitionend', closeTransitionEndHandler);
                applySquircleMask(overlay, ICON_RADIUS, lastIconRect.width, lastIconRect.height);
                overlay.style.width = `${lastIconRect.width}px`;
                overlay.style.height = `${lastIconRect.height}px`;
                overlay.style.transform = `translate(${lastIconRect.left}px, ${lastIconRect.top}px)`;
                overlay.style.opacity = '0';
                overlay.addEventListener('transitionend', closeTransitionEndHandler);
            }
            icons.forEach(icon => {
                icon.addEventListener('click', (e) => {
                    if (isAnimating) return;
                    console.log("Opening animation triggered");
                    isAnimating = true; animationDirection = 'opening'; currentIcon = e.currentTarget;
                    const iconRect = currentIcon.getBoundingClientRect();
                    const phoneScreenRect = phoneScreenElement.getBoundingClientRect();
                    const phoneScreenOffsetWidth = phoneScreenElement.offsetWidth;
                    const phoneScreenOffsetHeight = phoneScreenElement.offsetHeight;
                    const iconColor = window.getComputedStyle(currentIcon).backgroundColor;
                    lastIconRect = iconRect;
                    overlay.removeEventListener('transitionend', openTransitionEndHandler);
                    overlay.removeEventListener('transitionend', closeTransitionEndHandler);
                    overlay.style.backgroundColor = iconColor;
                    overlay.style.width = `${iconRect.width}px`;
                    overlay.style.height = `${iconRect.height}px`;
                    overlay.style.transform = `translate(${iconRect.left}px, ${iconRect.top}px)`;
                    overlay.style.opacity = '1'; overlay.style.display = 'block'; overlay.style.transformOrigin = 'top left';
                    applySquircleMask(overlay, ICON_RADIUS, iconRect.width, iconRect.height);
                    overlay.classList.add('visible');
                    void overlay.offsetWidth; // Force reflow
                    applySquircleMask(overlay, PHONE_SCREEN_RADIUS, phoneScreenOffsetWidth, phoneScreenOffsetHeight);
                    overlay.style.width = `${phoneScreenOffsetWidth}px`;
                    overlay.style.height = `${phoneScreenOffsetHeight}px`;
                    overlay.style.transform = `translate(${phoneScreenRect.left}px, ${phoneScreenRect.top}px)`;
                    overlay.addEventListener('transitionend', openTransitionEndHandler);
                    overlay.removeEventListener('click', closeOverlay);
                    overlay.addEventListener('click', closeOverlay);
                });
            });
        }

    </script>

</body>
</html>
